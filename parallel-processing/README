общий принцип: 
мастер процесс: 
читает stdin и пишет результаты в файл 

child: 
читает из пайпа, пишет в пайп и делает всё, что нужно 
система саморегулирующаяся, т.е по памяти уйти не должно

впили свой код в child, запусти, потом порегулируй параметры. 
в идеале должно получиться < 100% CPU на мастере и по 100%CPU на кайдом чайлде.
